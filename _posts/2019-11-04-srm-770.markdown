---
layout: post
title:  "TopCoder SRM 770 Div1"
date:   2017-04-28 12:06:30 +0800
tags: [srm]
comments: true
---

[standings](https://community.topcoder.com/stat?c=round_stats_sorted&rd=17723&sr=51&er=100&nr=50&dn=1&sq=Round_Statistics_Data&sc=16&sd=asc)  
å…¶å¯¦é€™å ´è »æ°´çš„ï¼Œåªæ˜¯æˆ‘è³½ä¸­ Medium æƒ³å¾ˆä¹…åªæƒ³å‡ºå‡è§£ FSTï¼Œæœ€å¾Œåªéäº† Easyï¼Œrank 58ã€‚
çœ‹å®Œ tourist çš„ code æ‰ç™¼ç¾ Medium å¾ˆç°¡å–®ï¼Œ
æ¯”å®Œèººåœ¨åºŠä¸Šç¡è¦ºæ™‚å°±ç™¼ç¾ Hard éä»½ç°¡å–®ã€‚

## [Easy: DeleteArrays](https://community.topcoder.com/stat?c=problem_statement&pm=15738)  
### é¡Œæ„
çµ¦å®š \\(A,B,C\\) ä¸‰å€‹æ­£æ•´æ•¸åºåˆ—è·Ÿä¸‰å€‹å¸¸æ•¸ \\(x,y,z\\)ï¼Œ
å¯ä»¥åŸ·è¡Œè‹¥å¹²æ¬¡æ“ä½œï¼Œ
æ¯æ¬¡å¾å…©å€‹ç›¸ç•°åºåˆ—å„è£¡åˆªæ‰ä¸€é …ï¼Œ
ä¸€æ¬¡æ“ä½œçš„ cost æ˜¯åˆªæ‰çš„æ•¸å­—å’ŒåŠ ä¸Š \\( (åˆª A,B: x;\; åˆª B,C: y;\; åˆª A,C: z)  \\)ã€‚
æ±‚ä¸‰å€‹åºåˆ—å‰©ä¸‹çš„æ•¸å­—å’Œçš„æœ€å°å€¼ï¼Œä»¥åŠé”æˆè©²å’Œçš„æœ€å°ç¸½ costã€‚

### è§£æ³•
é¦–å…ˆæœƒç™¼ç¾ cost è£¡ã€Œåˆªæ‰çš„æ•¸å­—å’Œã€æ˜¯å‡è­°é¡Œï¼Œå› ç‚ºåºåˆ—ç¸½å’Œæ˜¯å¸¸æ•¸ï¼Œ
å‰©ä¸‹çš„æœ€å°å’Œä¹Ÿæ˜¯å¸¸æ•¸ï¼Œæ‰€ä»¥é€™éƒ¨ä»½è²¢ç»çš„ cost ä¹Ÿæ˜¯å¸¸æ•¸ã€‚

è¦æœ€å°åŒ–æ•¸å­—å’Œçš„è©±ï¼Œå› ç‚ºåºåˆ—è£¡éƒ½æ˜¯æ­£æ•´æ•¸ï¼Œç•¶æœ‰å…©å€‹åºåˆ—éƒ½éç©ºæ™‚ä¸€å®šæœƒåšæ“ä½œï¼Œ
å› æ­¤æœ€å¤šåªæœƒå‰©ä¸‹ä¸€å€‹åºåˆ—éç©ºã€‚

æŠŠ \\(A,B,C\\) æ’åºå¾Œï¼Œ
åªæœ‰ä»–å€‘çš„å‰ç¶´å¯èƒ½æ˜¯ç­”æ¡ˆï¼Œ
è€Œä¸”åªéœ€è€ƒæ…®æœ€çŸ­å¯è¡Œçš„å‰ç¶´å’Œã€‚

WLOGï¼Œè¦åˆªå®Œ \\(B,C\\)ï¼Œç•™ä¸‹ \\(A\\) ç›¡é‡çŸ­çš„å‰ç¶´ã€‚
é‚£ç­–ç•¥å¾ˆé¡¯ç„¶ï¼Œå°±æ˜¯ä¸€ç›´åˆª \\(B,C\\) ç›´åˆ° \\(len(B) + len(C) <= len(A)\\)ï¼Œ
å†ç”¨å‰©ä¸‹çš„ \\(B,C\\) å»æ¶ˆé™¤ \\(A\\) çš„å¾Œç¶´ã€‚
åˆ°é€™é‚Šç™¼ç¾æœ€å°åŒ– cost ä¹Ÿæ˜¯å‡è­°é¡Œï¼Œåªæœƒæœ‰ä¸€ç¨® costã€‚

{% highlight c++ linenos %}
#include <bits/stdc++.h>
using namespace std;
#define REP(i,a,b) for (int i(a); i < (b); ++i)
#define PER(i,a,b) for(int i((a)-1); i >= (b); --i)
template<class T,class U>
bool cmax(T & a, const U & b) {return a < b ? a = b, 1 : 0;}
template<class T,class U>
bool cmin(T & a, const U & b) {return b < a ? a = b, 1 : 0;}
typedef long long ll;
typedef pair<int,int> pii;
typedef pair<ll,ll> pll;
#define F first
#define S second
typedef vector<int> vi;
typedef vector<ll> vll;
#define SZ(a) ((int)(a).size())
#define ALL(a) begin(a), end(a)
#define PB push_back
#define EB emplace_back
class DeleteArrays {
    vll go(vll & A,vll & B,vll & C,ll x,ll y,ll z)
    {
        int a=SZ(A),b=SZ(B),c=SZ(C);
        ll su = 0;
        ll co = 0;
        while (b && c && b + c > a) {
            co += B[--b] + C[--c] + y;
        }
        if (b + c > a)
            return {LLONG_MAX,LLONG_MAX};
        while (b) co += B[--b] + A[--a] + x;
        while (c) co += C[--c] + A[--a] + z;
        while (a) su += A[--a];
        return {su, co};
    }
    public:
    vector<long long> doDelete(int a, int b, int c, long long x, long long y, long long z) {
        vll A(a),B(b),C(c);
        A[0] = 33;
        A[1] = 42;
        for (int i = 2; i < a; ++i)
            A[i] = (5*A[i-1] + 7*A[i-2]) % 1000000007 + 1;
        B[0] = 13;
        for (int i = 1; i < b; ++i)
            B[i] = (11*B[i-1]) % 1000000007 + 1;
        C[0] = 7;
        C[1] = 2;
        for (int i = 2; i < c; ++i)
                C[i] = (5*C[i-1] + 7*C[i-2]) % 1000000007 + 1;
        sort(ALL(A));
        sort(ALL(B));
        sort(ALL(C));
        return min({
            go(A,B,C,x,y,z),
            go(B,C,A,y,z,x),
            go(C,A,B,z,x,y)
            });
    }
};
{% endhighlight %}
å¾Œé¢çš„ code å°±ä¸æ”¾æ¨¡æ¿äº†ï¼Œä½”ç©ºé–“ã€‚

## [Medium: ShoppingSpree](https://community.topcoder.com/stat?c=problem_statement&pm=15702)  
### é¡Œæ„
çµ¦ä¸€å¼µæœ‰ï¼ˆæ­£ï¼‰é»æ¬Šæ²’é‚Šæ¬Šçš„äºŒåˆ†åœ–ï¼Œé‚Šæ•¸ç‚º \\(d\\)ï¼Œå¯ä»¥é¸è‡³å¤š \\(k\\) æ¢é‚Šï¼Œ
æ±‚ä»–å€‘çš„ edge-induced subgraph æœ€å¤§çš„é»æ¬Šå’Œã€‚

### è§£æ³•
æœ€å°è²»ç”¨æµã€‚
å»ºæ¨¡çœ‹ codeï¼Œæ‡‰è©²å¾ˆå¥½æ‡‚ã€‚
å¯ä»¥æƒ³åƒæŒ‘ä¸€æ¢é‚Š \\( (u,v) \\) æ˜¯å¾ \\(u,v\\) åˆ†åˆ¥æ‹¿ä¸€å€‹æ•¸å­—ï¼Œ
ç¬¬ä¸€æ¬¡æ‹¿åˆ°é»æ¬Šï¼Œä¹‹å¾Œéƒ½æ˜¯ 0ï¼Œ
å› ç‚ºé»æ¬Šéƒ½æ˜¯æ­£çš„ï¼Œå–è² å¾Œä½œç‚ºæµç¶²è·¯ä¸­é‚Šçš„è²»ç”¨å¯ä»¥ä¿è­‰ç…§ä¸Šè¿°çš„é †åºæ‹¿æ•¸å­—ã€‚

{% highlight c++ linenos %}
struct CostFlow {
	static const int MXN = 205;
	static const long long INF = 102938475610293847LL;
	struct Edge {
		int v, r;
		long long f, c;
	};
	int n, s, t, prv[MXN], prvL[MXN], inq[MXN];
	long long dis[MXN], fl, cost;
	vector<Edge> E[MXN];
	void init(int _n, int _s, int _t) {
		n = _n; s = _s; t = _t;
		for (int i=0; i<n; i++) E[i].clear();
		fl = cost = 0;
	}
	void add_edge(int u, int v, long long f, long long c) {
		E[u].PB({v, SZ(E[v])  , f,  c});
		E[v].PB({u, SZ(E[u])-1, 0, -c});
	}
	pll flow() {
        while (true) {
            for (int i=0; i<n; i++) {
                dis[i] = INF;
                inq[i] = 0;
            }
            dis[s] = 0;
			queue<int> que;
			que.push(s);
			while (!que.empty()) {
				int u = que.front(); que.pop();
				inq[u] = 0;
				for (int i=0; i<SZ(E[u]); i++) {
					int v = E[u][i].v;
					long long w = E[u][i].c;
					if (E[u][i].f > 0 && dis[v] > dis[u] + w) {
						prv[v] = u; prvL[v] = i;
						dis[v] = dis[u] + w;
						if (!inq[v]) {
							inq[v] = 1;
							que.push(v);
						}
					}
				}
			}
			if (dis[t] == INF) break;
			long long tf = INF;
			for (int v=t, u, l; v!=s; v=u) {
				u=prv[v]; l=prvL[v];
				tf = min(tf, E[u][l].f);
			}
			for (int v=t, u, l; v!=s; v=u) {
				u=prv[v]; l=prvL[v];
				E[u][l].f -= tf;
				E[v][E[u][l].r].f += tf;
			}
			cost += tf * dis[t];
			fl += tf;
		}
		return {fl, cost};
	}
}flow;
class ShoppingSpree {
    public:
    int maxValue(int k, vector<int> a, vector<int> b, vector<int> x, vector<int> y) {
        int n = a.size(), m = b.size(), d = x.size();
        int s0 = n + m, s1 = n + m + 1, t = n + m + 2;
        flow.init(n+m+3,s0,t);
        flow.add_edge(s0,s1,k,0);
        for (int i = 0; i < n; ++i) {
            flow.add_edge(s1,i,1,-a[i]);
            flow.add_edge(s1,i,k,0);
        }
        for (int i = 0; i < d; ++i)
            flow.add_edge(x[i],n+y[i],1,0);
        for (int i = 0; i < m; ++i) {
            flow.add_edge(n+i,t,1,-b[i]);
            flow.add_edge(n+i,t,k,0);
        }
        return flow.flow().S * -1;
    }
};
{% endhighlight %}

## [Hard: RandomSelection](https://community.topcoder.com/stat?c=problem_statement&pm=15687)
### é¡Œæ„
çµ¦å®šä¸€å€‹é•·åº¦ \\(n\\) çš„éè² æ•´æ•¸åºåˆ— \\(A\\)ï¼Œ
\\(a_i\\) æ˜¯å¾ \\( [0,A_i] \\) uniformly at random é¸çš„ä¸€å€‹å¯¦æ•¸ï¼Œ
æ±‚ \\( E[\max_{i=1}^{n}(a_i)] \\)ã€‚

### è§£æ³•
ç°¡å–®æ©Ÿç‡è·Ÿå¾®ç©åˆ†ã€‚

å¯¦æ•¸ä¸ŠæœŸæœ›å€¼çš„å®šç¾©æ˜¯é€™æ¨£çš„ï¼š

\\[ E[X] = \int_{\mathbb{R}} x f(x) dx \\]

\\( f(x) \\) æ˜¯æ©Ÿç‡å¯†åº¦å‡½æ•¸ (Probability density function (PDF))ã€‚  
\\( F(x) = Pr( X \le x ) \\) æ˜¯ç´¯ç©åˆ†å¸ƒå‡½æ•¸ (Cumulative Distribution Function(CDF))ã€‚  
\\( f(x) = \frac{d F(x)}{dx} \\)ã€‚


ä»¤ \\(X = \max_{i=1}^{n}(a_i)\\)ã€‚
\\[ Pr( X \le x ) = \prod_{i=1}^{n}Pr(a_i \le x) = \prod_{i=1}^{n}\frac{ \min(x,A_i) }{A_i} \\]
é‚£æˆ‘å€‘å…ˆæŠŠ \\(A\\) ç”±å¤§åˆ°å°æ’åºï¼Œå°¾å·´åŠ å€‹ 0ï¼Œæ–¹ä¾¿æ¨å¼å­ã€‚  
å¯å¾—å‡º  
$$
\begin{align*}
F(x) &= \frac{x^i}{\prod_{j=1}^{i} A_i }\text{ if }x \in [A_{i+1}, A_i] \\
f(x) &= \frac{d F(x)}{dx} = \frac{i x^{i-1}}{\prod_{j=1}^{i} A_i }\text{ if }x \in [A_{i+1}, A_i]\\
E[A_{i+1} \le X \le A_i] &= \int_{A_{i+1}}^{A_i} x f(x) dx = \frac{i x^{i+1}}{ (i+1) \prod_{j=1}^{i} A_i }
\end{align*}
$$

å‰©ä¸‹å°±æ˜¯å¯¦åšå•é¡Œäº†ã€‚
å› ç‚ºä¹˜çš„æ•¸å­—å¾ˆå¤§ï¼Œæ¬¡æ–¹å¾ˆé«˜ï¼Œç¸½ä¹‹æœƒæƒ³å…ˆæŠŠæ‰€æœ‰æ±è¥¿å–å€‹ \\(\log\\)ï¼Œä¹˜é™¤è·Ÿæ¬¡æ–¹ç”¨åŠ æ¸›ä¹˜å–ä»£ï¼Œæœ€å¾Œå† \\(\exp\\) å›ä¾†ã€‚
æˆ‘çš„ code ï¼ˆè·Ÿå…¶ä»–å¾ˆå¤šäººçš„ï¼‰ç”¨ double ç²¾åº¦ä¸å¤ æœƒ WAï¼Œæ”¹ long double æ‰éã€‚



{% highlight c++ linenos %}
typedef long double val;
class RandomSelection {
    public:
    double expectedMaximum(int n, int T, int seed, int Amod, vector<int> Aprefix) {
        vll A(n+1);
        for (int i = 1; i <= SZ(Aprefix); ++i)
            A[i] = Aprefix[i-1];
        ll state = seed;
        for (int i = SZ(Aprefix) + 1; i <= n; ++i) {
            state = (1103515245 * state + 12345) % (1ll<<31);
            A[i] = T + (state % Amod);
        }
        sort(ALL(A),greater<ll>());
        val ret = 0, C = 0;
        for (int i = 1; i <= n; ++i) {
            ll a = A[i], b = A[i-1];
            C += log(b);
            auto f = [&](val x) -> val {
                if (x == 0)
                    return 0;
                return exp(((i+1) * log(x) + log(i)) - (C + log(i+1)));
            };
            ret += f(b) - f(a);
        }
        return ret;
    }
};
{% endhighlight %}

### é¡Œå¤–è©±
é€™ä»½ code åªæœ‰åšæ’åºè·Ÿ \\(O(N)\\) æ¬¡ \\(\log, \exp\\) é‹ç®—ï¼Œæœ€æ…¢çš„æ¸¬è³‡ä¹Ÿæ‰è·‘ 67 msã€‚
[Petr è³½ä¸­](https://youtu.be/3oIrxt5Btvc?t=4160) ç”¨ Java å¯«å®Œç¬¬ä¸‰é¡Œï¼Œ
å¯«å®Œéš¨æ‰‹ä¸€æ¸¬ 2.591sï¼ˆæ‡‰è©²è·Ÿæˆ‘è§£æ³•ä¸åŒè¤‡é›œåº¦ï¼Œæ²’ä»”ç´°çœ‹ä»– codeï¼‰ï¼Œ
çœ‰é ­ä¸€çšºç™¼ç¾ä¸å°å‹ï¼Œ
TL æ˜¯ 2sï¼Œ
æ–¼æ˜¯ Petr éˆæ©Ÿä¸€å‹•ï¼Œ
æŠŠä»–çš„ Java code è²¼åˆ° sol.cpp è£¡é–‹å§‹æ”¹å¯«æˆ C++ã€‚
é€™è¼©å­ç¬¬ä¸€æ¬¡çœ‹åˆ° Petr å¯« C++ï¼Œ
ç¬‘æ­»ğŸ¤£ğŸ¤£ğŸ¤£ã€‚